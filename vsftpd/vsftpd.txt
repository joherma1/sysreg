apt-get install vsftpd

/etc/vsftpd.conf:


 vi /etc/vsftpd.chroot_list:


 root@server-roveitor:/home# mkdir alreg
root@server-roveitor:/home# cd alreg/
root@server-roveitor:/home/alreg# mkdir proto1

root@server-roveitor:/home/alreg# groupadd alreg
root@server-roveitor:/home/alreg# useradd -g alreg -d /home/alreg/proto1/ -c "Prototipo numero 1" proto1
root@server-roveitor:/home/alreg# useradd -g alreg -d /home/alreg/ -c "Adminstrador servidor FTP" adminFTP
passwd proto1
passwd adminFTP

Ahora creamos una shell fantasma en el directorio correspondiente.

sudo mkdir /bin/alreg

Editamos el fichero /etc/shells y la añadimos en la ultima línea “/bin/alreg" y guardamos:

sudo vi /etc/shells

Editamos el fichero /etc/passwd y buscamos las líneas donde están definidos los usuarios que hemos creado antes y les añadimos el shell falso:

proto1:x:1001:1001:Prototipo numero 1:/home/alreg/proto1/:/bin/alreg
adminFTP:x:1002:1001:Adminstrador servidor FTP:/home/alreg/:/bin/alreg


Ahora vamos a crear el fichero de usuarios:

sudo gedit /etc/vsftpd.chroot_list


sudo /etc/init.d/vsftpd restart

Editamos los permisos de /home
drwxr-xr-x  4 root     root  4096 dic  4 18:17 .
drwxr-xr-x 23 root     root  4096 oct 13 23:16 ..
drwxr-xr-x  3 adminFTP alreg 4096 dic  4 18:27 alreg
drwxr-x---  4 jose     jose  4096 dic  4 18:29 jose

y proto1:

drwxr-xr-x 3 adminFTP alreg 4096 dic  4 18:17 .
drwxr-xr-x 4 root     root  4096 dic  4 18:17 ..
drwxr-xr-x 2 proto1   alreg 4096 dic  4 18:17 proto1


proto1:agricultura.1
adminFTP:Soluciones13

Añadir las siguiente directivas en el fichero vsftpd.conf para evitar los errores de chroot y bad IP connection
#Para que no aparezca el error "vsftpd: refusing to run with writable root inside chroot ()"
local_root=/home

#Para permitir que una coneccion pasiva cree fichero y evitar el "Bad IP connecting"
pasv_promiscuous=YES

